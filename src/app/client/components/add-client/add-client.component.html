<app-header [title]="'Add Client'"></app-header>


<div class="add-client-container">
  <form [formGroup]="clientForm" class="client-from">
    <div class="basic-info-container">
      <mat-form-field class="form-input">
        <mat-label>* Name</mat-label>
        <input matInput formControlName="name">
        <mat-error *ngIf="clientForm.get('name').touched && clientForm.get('name').errors?.required">
          Name is <strong>required</strong>
        </mat-error>

        <mat-error *ngIf="clientForm.get('name').touched && clientForm.get('name').errors?.twoLanguageNotAllowed">
          English and Georgian together is not allowed
        </mat-error>

        <mat-error *ngIf="clientForm.get('name').touched && clientForm.get('name').errors?.wrongCharacters">
          Only allowed languages are English and Georgian
        </mat-error>

        <mat-error *ngIf="clientForm.get('name').touched && clientForm.get('name').errors?.minlength">
          Name should be at least 2 characters long
        </mat-error>

        <mat-error *ngIf="clientForm.get('name').touched && clientForm.get('name').errors?.maxlength">
          Name should be maximum 50 characters long
        </mat-error>

      </mat-form-field>

      <mat-form-field class="form-input">
        <mat-label>* Last Name</mat-label>
        <input matInput formControlName="lastName">
        <mat-error *ngIf="clientForm.get('lastName').touched && clientForm.get('lastName').errors?.required">
          Name is <strong>required</strong>
        </mat-error>

        <mat-error *ngIf="clientForm.get('lastName').touched && clientForm.get('lastName').errors?.twoLanguageNotAllowed">
          English and Georgian together is not allowed
        </mat-error>

        <mat-error *ngIf="clientForm.get('lastName').touched && clientForm.get('lastName').errors?.wrongCharacters">
          Only allowed languages are English and Georgian
        </mat-error>

        <mat-error *ngIf="clientForm.get('lastName').touched && clientForm.get('lastName').errors?.minlength">
          Name should be at least 2 characters long
        </mat-error>

        <mat-error *ngIf="clientForm.get('lastName').touched && clientForm.get('lastName').errors?.maxlength">
          Name should be maximum 50 characters long
        </mat-error>
      </mat-form-field>

      <mat-form-field class="form-input">
        <mat-label>* Gender</mat-label>
        <mat-select formControlName="gender">
          <mat-option value="male">Male</mat-option>
          <mat-option value="female">Female</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="form-input">
        <mat-label>* ID number</mat-label>
        <input matInput formControlName="idNumber">
        <mat-error *ngIf="clientForm.get('idNumber').touched &&
      clientForm.get('idNumber').errors?.required">
          ID number is <strong>required</strong>
        </mat-error>

        <mat-error *ngIf="clientForm.get('idNumber').touched &&
      clientForm.get('idNumber').errors?.onlyNumber">
          ID Number should contain only numeric values
        </mat-error>

        <mat-error *ngIf="clientForm.get('idNumber').touched &&
      clientForm.get('idNumber').errors?.minlength || clientForm.get('idNumber').errors?.maxlength">
          ID number should be 11 characters long
        </mat-error>
      </mat-form-field>

      <mat-form-field class="form-input">
        <mat-label>* Mobile</mat-label>
        <input matInput formControlName="mobile">
        <mat-error *ngIf="clientForm.get('mobile').touched &&
      clientForm.get('mobile').errors?.required">
          Mobile is <strong>required</strong>
        </mat-error>

        <mat-error *ngIf="clientForm.get('mobile').touched &&
      clientForm.get('mobile').errors?.minlength || clientForm.get('mobile').errors?.maxlength">
          Mobile should be 9 characters long
        </mat-error>

        <mat-error *ngIf="clientForm.get('mobile').touched &&
      clientForm.get('mobile').errors?.onlyNumber">
          Mobile should contain only numeric values
        </mat-error>

      </mat-form-field>
    </div>

    <div class="address-container">
      <div class="address-box">
        <p class="help-block">Registered Address</p>
        <div formGroupName="registeredAddress" class="client-from">
          <mat-form-field class="form-input address-form-input">
            <mat-label>* City</mat-label>
            <input matInput formControlName="city">
            <mat-error *ngIf="clientForm.get('registeredAddress').get('city').touched &&
        clientForm.get('registeredAddress').get('city').errors?.required">
              City is <strong>required</strong>
            </mat-error>
          </mat-form-field>

          <mat-form-field class="form-input address-form-input">
            <mat-label>* Country</mat-label>
            <input matInput formControlName="country">
            <mat-error *ngIf="clientForm.get('registeredAddress').get('country').touched &&
        clientForm.get('registeredAddress').get('country').errors?.required">
              Country is <strong>required</strong>
            </mat-error>
          </mat-form-field>


          <mat-form-field class="form-input address-form-input">
            <mat-label>* Address</mat-label>
            <input matInput formControlName="address">
            <mat-error *ngIf="clientForm.get('registeredAddress').get('address').touched &&
        clientForm.get('registeredAddress').get('address').errors?.required">
              Address is <strong>required</strong>
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <div  class="address-box">
        <div>
          <span class="help-block">Actual Address &nbsp;&nbsp;
          <span class="help-block-small">Same as registered address</span>&nbsp;
            <mat-checkbox (change)="actualAddressCheckboxClicked($event)" class="example-margin"></mat-checkbox>
          </span>
        </div>
        <div formGroupName="actualAddress" class="client-from" id="actualAddress">
          <mat-form-field class="form-input address-form-input">
            <mat-label>* City</mat-label>
            <input matInput formControlName="city">
            <mat-error *ngIf="clientForm.get('actualAddress').get('city').invalid &&
        clientForm.get('actualAddress').get('city').touched">
              City is <strong>required</strong>
            </mat-error>
          </mat-form-field>

          <mat-form-field class="form-input address-form-input">
            <mat-label>* Country</mat-label>
            <input matInput formControlName="country">
            <mat-error *ngIf="clientForm.get('actualAddress').get('country').invalid &&
        clientForm.get('actualAddress').get('country').touched">
              Country is <strong>required</strong>
            </mat-error>
          </mat-form-field>


          <mat-form-field class="form-input address-form-input">
            <mat-label>* Address</mat-label>
            <input matInput formControlName="address">
            <mat-error *ngIf="clientForm.get('actualAddress').get('address').invalid &&
        clientForm.get('actualAddress').get('address').touched">
              Address is <strong>required</strong>
            </mat-error>
          </mat-form-field>
        </div>
      </div>
    </div>

    <app-photo-uploader (photoUploaded)="onPhotoUploaded($event)"></app-photo-uploader>
    <img class="uploaded-photo" [src]="clientForm.get('photo').value" alt="">
    <p *ngIf="photoName" class="photoName">{{photoName}}</p>
    <div class="gap"></div>
    <h4 class="add-account-text">Add Account(s) &nbsp;
      <button (click)="addAccount()" class="add-account-button">+Add</button></h4>
    <div class="account-container" formArrayName="account">
      <div class="account-group-container" *ngFor="let account of clientForm.get('account')['controls']; let i = index" [formGroupName]="i">

        <mat-form-field class="form-input">
          <mat-label>Account N.</mat-label>
          <input matInput formControlName="accountNumber">
<!--          <mat-error *ngIf="clientForm.get('actualAddress').get('address').invalid &&-->
<!--        clientForm.get('actualAddress').get('address').touched">-->
<!--            Address is <strong>required</strong>-->
<!--          </mat-error>-->
        </mat-form-field>

        <mat-form-field class="form-input">
          <mat-label>Account Type</mat-label>
          <input matInput formControlName="accountType">
          <!--          <mat-error *ngIf="clientForm.get('actualAddress').get('address').invalid &&-->
          <!--        clientForm.get('actualAddress').get('address').touched">-->
          <!--            Address is <strong>required</strong>-->
          <!--          </mat-error>-->
        </mat-form-field>

        <mat-form-field class="form-input">
          <mat-label>Currency</mat-label>
          <mat-select formControlName="currency" multiple>
            <mat-option value="GEL">GEL</mat-option>
            <mat-option value="USD">USD</mat-option>
            <mat-option value="EUR">EUR</mat-option>
            <mat-option value="RUB">RUB</mat-option>
          </mat-select>
<!--          <input matInput formControlName="currency">-->
          <!--          <mat-error *ngIf="clientForm.get('actualAddress').get('address').invalid &&-->
          <!--        clientForm.get('actualAddress').get('address').touched">-->
          <!--            Address is <strong>required</strong>-->
          <!--          </mat-error>-->
        </mat-form-field>

        <mat-form-field class="form-input">
          <mat-label>Account Status</mat-label>
          <input matInput formControlName="accountStatus">
          <!--          <mat-error *ngIf="clientForm.get('actualAddress').get('address').invalid &&-->
          <!--        clientForm.get('actualAddress').get('address').touched">-->
          <!--            Address is <strong>required</strong>-->
          <!--          </mat-error>-->
        </mat-form-field>
        <mat-icon [ngStyle]="{opacity: i > 0 ? '1' : 0, cursor: i > 0 ? 'pointer' : 'default'}"
                  (click)="i > 0 && removeAccount(i)"
                  class="delete-icon">delete</mat-icon>
      </div>
    </div>

    <button [ngClass]="{disabled: clientForm.invalid}" (click)="addClient()" class="add-client-button">Add Client</button>
  </form>
</div>
